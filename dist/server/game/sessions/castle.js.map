{"version":3,"sources":["../../../../src/server/game/sessions/castle.js"],"names":[],"mappings":"s5EAOM;;;KAKJ,SALI,MAKJ,CAAY,EAAZ,CAAgB,sBALZ,QAKY,6DALZ,kBAMI,SAAU,KADF;;kBALZ,6CAYK,CACP,KAAK,WAAL,GADO,IAEP,CAAK,WAAL,GAFO;;sDAQK,iBACZ,IAAM,eAAiB,CACrB,CAAE,MAAO,MAAP,CAAe,SAAU,SAAV,CADI,CAErB,CAAE,MAAO,OAAP,CAAgB,SAAU,SAAV,CAFG,CAGrB,CAAE,MAAO,QAAP,CAAiB,SAAU,SAAV,CAHE,CAIrB,CAAE,MAAO,QAAP,CAAiB,SAAU,SAAV,CAJE,CAAjB,CADM,IAQN,YAAc,KAAK,WAAL,CAAiB,aAAjB,EAAgC,MAAhC,CAAuC,wBAAU,OAAO,IAAP,GAAgB,MAAhB,CAAV,CAArD,CARM,mBAUZ,CAAQ,cAAR,CAAwB,SAAC,KAAD,CAAQ,KAAR,CAAkB,CACxC,OAAK,QAAL,CAAc,kCACT,OACH,KAAM,uBAAY,IAAZ,CACN,GAAI,kBAAQ,QAAR,EAAJ,CACA,KAAM,iBAAK,YAAY,KAAZ,CAAL,CAAyB,CAAC,GAAD,CAAM,GAAN,CAAW,OAAX,CAAoB,QAApB,CAAzB,CAAN,EAJY,CAAd,EADwC,CAA1C,CAVY;;sDAuBA,iBACZ,IAAM,YAAc,KAAK,WAAL,CAAiB,aAAjB,EAAgC,MAAhC,CAAuC,wBAAU,OAAO,IAAP,GAAgB,MAAhB,CAAV,CAArD,CADM,mBAGZ,CAAQ,WAAR,CAAqB,eAAS,CAC5B,OAAK,QAAL,CAAc,kCACT,OACH,GAAI,kBAAQ,QAAR,EAAJ,CACA,KAAM,uBAAY,IAAZ,EAHM,CAAd,EAD4B,CAA9B,CAHY;;;iDAgBJ,MAAO,CACf,2BA5DE,8CA4Dc,MAAhB,CADe,IAGT,OAAS,4BAAkB,KAAK,SAAL,CAAe,QAAf,CAA3B,CAHS,IAKf,CAAK,QAAL,CAAc,qBAAS,MAAT,CAAiB,MAAM,EAAN,CAA/B,EALe;;;uDAYJ,GAAI,CACf,2BAxEE,iDAwEiB,GAAnB,CADe,IAGf,CAAK,QAAL,CAAc,sBAAU,EAAV,CAAd,EAHe,WAvEb,2CA8ES","file":"castle.js","sourcesContent":["import shortid from 'shortid';\nimport { forEach, pick } from 'lodash';\nimport Session from '../session';\nimport { addEntity, joinTeam, leaveTeam } from '../../actions/entity';\nimport { findWeakestTeamId } from '../../helpers/game';\nimport { EntityTypes } from 'shared/constants';\n\nclass Castle extends Session {\n  /**\n   * Creates a new game session.\n   * @param io\n   */\n  constructor(io) {\n    super('castle', io);\n  }\n  \n  /**\n   * Creates this session.\n   */\n  create() {\n    this.createTeams();\n    this.createFlags();\n  }\n\n  /**\n   * Creates the teams for this session.\n   */\n  createTeams() {\n    const teamColorProps = [\n      { color: 'blue', hexColor: '#46bce3' },\n      { color: 'green', hexColor: '#86d93d' },\n      { color: 'orange', hexColor: '#fda551' },\n      { color: 'purple', hexColor: '#9c44b5' }\n    ];\n\n    const baseObjects = this.getGameData('map.objects').filter(object => object.type === 'base');\n\n    forEach(teamColorProps, (props, index) => {\n      this.dispatch(addEntity({\n        ...props,\n        type: EntityTypes.TEAM,\n        id: shortid.generate(),\n        base: pick(baseObjects[index], ['x', 'y', 'width', 'height'])\n      }));\n    });\n  }\n\n  /**\n   * Creates the flags for this session.\n   */\n  createFlags() {\n    const flagObjects = this.getGameData('map.objects').filter(object => object.type === 'flag');\n    \n    forEach(flagObjects, props => {\n      this.dispatch(addEntity({\n        ...props,\n        id: shortid.generate(),\n        type: EntityTypes.FLAG\n      }));\n    });\n  }\n\n  /**\n   * Adds a player to this session.\n   * @param {Object} props\n   */\n  addPlayer(props) {\n    super.addPlayer(props);\n\n    const teamId = findWeakestTeamId(this.gameState.entities);\n\n    this.dispatch(joinTeam(teamId, props.id));\n  }\n\n  /**\n   * Removes a player from this session.\n   * @param {string} id\n   */\n  removePlayer(id) {\n    super.removePlayer(id);\n    \n    this.dispatch(leaveTeam(id));\n  }\n}\n\nexport default Castle;\n"]}