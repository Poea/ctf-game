{"version":3,"sources":["../../../../src/server/game/sessions/castle.js"],"names":[],"mappings":"68EAQM;;;KAKJ,SALI,MAKJ,CAAY,EAAZ,CAAgB,sBALZ,QAKY,6DALZ,kBAMI,SAAU,KADF;;kBALZ,6CAYK,CACP,KAAK,WAAL,GADO,IAEP,CAAK,WAAL,GAFO;;sDAQK,iBACZ,IAAM,eAAiB,CACrB,CAAE,MAAO,MAAP,CAAe,SAAU,SAAV,CADI,CAErB,CAAE,MAAO,OAAP,CAAgB,SAAU,SAAV,CAFG,CAGrB,CAAE,MAAO,QAAP,CAAiB,SAAU,SAAV,CAHE,CAIrB,CAAE,MAAO,QAAP,CAAiB,SAAU,SAAV,CAJE,CAAjB,CADM,IAQN,YAAc,KAAK,WAAL,CAAiB,aAAjB,EAAgC,MAAhC,CAAuC,wBAAU,OAAO,IAAP,GAAgB,uBAAY,IAAZ,CAA1B,CAArD,CARM,mBAUZ,CAAQ,cAAR,CAAwB,SAAC,KAAD,CAAQ,KAAR,CAAkB,CACxC,OAAK,QAAL,CAAc,mCACT,OACH,KAAM,uBAAY,IAAZ,CACN,GAAI,kBAAQ,QAAR,EAAJ,CACA,KAAM,iBAAK,YAAY,KAAZ,CAAL,CAAyB,CAAC,GAAD,CAAM,GAAN,CAAW,OAAX,CAAoB,QAApB,CAAzB,CAAN,EAJY,CAAd,EADwC,CAA1C,CAVY;;sDAuBA,iBACZ,IAAM,UAAY,KAAK,WAAL,CAAiB,eAAjB,CAAZ,CADM,IAEN,YAAc,KAAK,WAAL,CAAiB,aAAjB,EAAgC,MAAhC,CAAuC,wBAAU,OAAO,IAAP,GAAgB,uBAAY,IAAZ,CAA1B,CAArD,CAFM,mBAIZ,CAAQ,WAAR,CAAqB,eAAS,CAC5B,OAAK,QAAL,CAAc,mCACT,MACA,WACH,KAAM,uBAAY,IAAZ,CACN,GAAI,kBAAQ,QAAR,EAAJ,EAJY,CAAd,EAD4B,CAA9B,CAJY;;;iDAkBJ,MAAO,CACf,2BA9DE,8CA8Dc,MAAhB,CADe,IAGT,OAAS,4BAAkB,KAAK,SAAL,CAAe,QAAf,CAA3B,CAHS,IAIf,CAAK,QAAL,CAAc,sBAAS,MAAT,CAAiB,MAAM,EAAN,CAA/B,EAJe,IAMT,KAAO,KAAK,SAAL,CAAe,MAAf,CAAP,CANS,0BAOE,qCAA2B,KAAK,KAAL,CAAY,KAAvC,EAPF,IAOP,0BAPO,IAOJ,0BAPI,IAQf,CAAK,QAAL,CAAc,wBAAY,MAAM,EAAN,CAAU,CAAtB,CAAyB,CAAzB,CAAd,EARe;;;uDAeJ,GAAI,CACf,2BA7EE,iDA6EiB,GAAnB,CADe,IAGf,CAAK,QAAL,CAAc,uBAAU,EAAV,CAAd,EAHe,WA5Eb,2CAmFS","file":"castle.js","sourcesContent":["import shortid from 'shortid';\nimport { forEach, pick } from 'lodash';\nimport Session from '../session';\nimport { setPosition } from 'shared/actions/entity';\nimport { addEntity, joinTeam, leaveTeam } from '../../actions/entity';\nimport { findWeakestTeamId, calculateTeamSpawnPosition } from '../../helpers/game';\nimport { EntityTypes } from 'shared/constants';\n\nclass Castle extends Session {\n  /**\n   * Creates a new game session.\n   * @param io\n   */\n  constructor(io) {\n    super('castle', io);\n  }\n  \n  /**\n   * Creates this session.\n   */\n  create() {\n    this.createTeams();\n    this.createFlags();\n  }\n\n  /**\n   * Creates the teams for this session.\n   */\n  createTeams() {\n    const teamColorProps = [\n      { color: 'blue', hexColor: '#46bce3' },\n      { color: 'green', hexColor: '#86d93d' },\n      { color: 'orange', hexColor: '#fda551' },\n      { color: 'purple', hexColor: '#9c44b5' }\n    ];\n\n    const baseObjects = this.getGameData('map.objects').filter(object => object.type === EntityTypes.BASE);\n\n    forEach(teamColorProps, (props, index) => {\n      this.dispatch(addEntity({\n        ...props,\n        type: EntityTypes.TEAM,\n        id: shortid.generate(),\n        base: pick(baseObjects[index], ['x', 'y', 'width', 'height'])\n      }));\n    });\n  }\n\n  /**\n   * Creates the flags for this session.\n   */\n  createFlags() {\n    const flagProps = this.getGameData('entities.flag');\n    const flagObjects = this.getGameData('map.objects').filter(object => object.type === EntityTypes.FLAG);\n    \n    forEach(flagObjects, props => {\n      this.dispatch(addEntity({\n        ...props,\n        ...flagProps,\n        type: EntityTypes.FLAG,\n        id: shortid.generate()\n      }));\n    });\n  }\n\n  /**\n   * Adds a player to this session.\n   * @param {Object} props\n   */\n  addPlayer(props) {\n    super.addPlayer(props);\n\n    const teamId = findWeakestTeamId(this.gameState.entities);\n    this.dispatch(joinTeam(teamId, props.id));\n\n    const team = this.getEntity(teamId);\n    const { x, y } = calculateTeamSpawnPosition(team.props, props);\n    this.dispatch(setPosition(props.id, x, y));\n  }\n\n  /**\n   * Removes a player from this session.\n   * @param {string} id\n   */\n  removePlayer(id) {\n    super.removePlayer(id);\n    \n    this.dispatch(leaveTeam(id));\n  }\n}\n\nexport default Castle;\n"]}